
# Prepare SSH-Agent
SSHAGENT=/usr/bin/ssh-agent
SSHAGENTARGS="-s -t10h"
if [ -z "$SSH_AUTH_SOCK" -a -x "$SSHAGENT" ]; then
    eval `$SSHAGENT $SSHAGENTARGS`
    trap "kill $SSH_AGENT_PID" 0
fi

# Direct connection to X-server
#if [ ! "$SSH_CONNECTION" = "" ]; then
#    #IP=`echo $SSH_CONNECTION | cut -d' ' -f1`
#    IP=`dig +short bun-tschlin.scs-ad.scs.ch`
#    export DISPLAY="${IP}:0.0"
#fi

# Colourful ls output
eval $(dircolors)
LS_COLORS=$LS_COLORS":*.vhd=00;93:*.v=00;93:*.vp=00;93:*.vh=00;93:*.ngc=00;33:"

# Favourite directory browsing functions
FAVDIR_FILE="${HOME}/.favdirs"
function favdir_goto
{
    # Check the argument
    if [ ${1} == "" ]; then
	echo "Error: Please provide a designator for the directory to go to!"
	exit 1
    fi

    # Check if the designator exists and change there
    grep -s "^${1}=" ${FAVDIR_FILE} > /dev/null
    if [ $? -eq 0 ]; then
	NEXTDIR=$(grep --color=never "^${1}=" ${FAVDIR_FILE})
	NEXTDIR=${NEXTDIR#"${1}="}
	cd ${NEXTDIR}
    else
	echo "Error: Either dirlist file ${FAVDIR_FILE} does not exists, or the required dirname ${1} was not found in the file!"
    fi
}

function favdir_set
{
    # Check the argument
    if [ ${1} == "" ]; then
	echo "Error: Please provide a designator for the directory to go to!"
	exit 1;
    fi

    # Store or overwrite the designator with the new directory
    grep -s "^${1}=" ${FAVDIR_FILE} > /dev/null
    if [ $? -eq 0 ]; then
	sed -i "/^${1}=/d" ${FAVDIR_FILE}
    fi
    echo "${1}=$(pwd)" >> ${FAVDIR_FILE}
}

# Highlighting function
function color
{
    grep * 2>&1
    grep --color "${1}\|$"
}

# Aliases for convenience
alias ls='ls --color=auto'
alias ll='ls -hl --time-style=long-iso'
alias grep='grep --color=auto'
alias d="favdir_goto"
alias r="favdir_set"
alias push="git stash && git pull --rebase && git push; git stash pop"
alias pull="git stash && git pull --rebase; git stash pop"
alias e="emacs -nw"
alias emasc="emacs"
function xenv { . /opt/toolchain/xilinx/Xilinx${1}i/settings64.sh && echo -en "\033]2;Xilinx ${1}\007"; }
alias x="xenv 14.5"
alias m="export PATH=/opt/toolchain/modelsim/modelsim_dlx_10.0e/bin:${PATH}"
#alias m="export PATH=/opt/toolchain/modelsim/modelsim_dlx_10.2a/bin:${PATH}"
alias s="ssh-add"
[[ -x ~/sandbox/tig-1.1/tig ]]   && alias tig="~/sandbox/tig-1.1/tig --all"
[[ ! -x ~/sandbox/tig-1.1/tig ]] && alias tig="tig --all"
alias gitk="gitk --all"
alias ssh="ssh"
alias log="tail --retry --follow=name"
alias tree="tree -C"
alias gdiff="git diff --no-index"
alias uncolor="sed -i -r 's/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]//g'"

# 256 colors for terminal
export TERM="xterm-256color"

# Some other variables
export EDITOR="emacs -nw"
export LESS="-iRS"

# Smart bash completion
if [ -f /etc/bash_completion ]; then
 . /etc/bash_completion
fi
